name: Install GHC and cabal

inputs:
  ghc-version:
    required: true
    description: GHC version to install
  path:
    required: true
    description: Absolute path where to install GHC and cabal

runs:
  using: "composite"
  steps:
    - name: Set up ghc cache
      id: ghc-cache
      uses: actions/cache@v3
      with:
        path: ${{ inputs.path }}
        key: ghc-${{ runner.os }}-${{ inputs.ghc-version }}

    - name: Install GHC ${{ inputs.ghc-version }}
      shell: bash
      if: steps.ghc-cache.outputs.cache-hit != 'true'
      run: |
        ghcup install ghc ${{ inputs.ghc-version }} --isolate ${{ inputs.path }}
        ghcup install cabal latest --isolate ${{ inputs.path }}/bin

    - name: Add ghc bin to path
      shell: bash
      run: echo "${{ inputs.path }}/bin" >> $GITHUB_PATH
